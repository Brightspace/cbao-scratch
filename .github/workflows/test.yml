name: test

on:
  push:
  pull_request:
  workflow_dispatch:
    inputs:
      environment:
        description: "which"
        required: false
        type: choice
        default: ""
        options: [dev, staging, prod]

jobs:
  dev:
    if: github.event.inputs.environment == '' || github.event.inputs.environment == 'dev'
    runs-on: [self-hosted, Linux, AWS]
    steps:
      - run: echo dev

  staging:
    needs: dev
    if: |
      github.ref == 'refs/heads/main'
      && (github.event.inputs.environment == '' || github.event.inputs.environment == 'staging')
      && (needs.dev.result == 'success' || needs.dev.result == 'skipped')
    runs-on: [self-hosted, Linux, AWS]
    steps:
      - run: echo staging

  prod:
    needs: staging
    if: |
      github.ref == 'refs/heads/main'
      && (github.event.inputs.environment == '' || github.event.inputs.environment == 'prod')
      && (needs.staging.result == 'success' || needs.staging.result == 'skipped')
    runs-on: [self-hosted, Linux, AWS]
    steps:
      - run: echo prod
